---
title: Discord.jsを使用してグローバルチャットっぽいものを作ってみた。
description: Discord.js使ってみんなが「グローバルチャット」と呼ぶものを作ったみた。
tags:
  - JavaScript
  - Discord
  - Node.js
modifiedDate: 2020-06-13T03:45:12.000Z
createdDate: 2020-06-13T03:45:12.000Z
---

みんなが「グローバルチャット」と呼ぶものを、Discord.jsを使って[JavaScript](/tags/javascript)で書いてみました。

- [リポジトリ](https://github.com/InkoHX/share-chat-webhook-discordjs)
  - ダウンロードも上記のリンク先で行なえます

## 注意

- `data.json` というファイルを作成し、共有化されたチャンネルのIDとWebhookのIDを保存します
  - Discord.js Japan User Group の[更新したら自動で保存されるオブジェクトのサンプル](https://scrapbox.io/discordjs-japan/更新したら自動で保存されるオブジェクトのサンプル)を使用しています
  - [Node.js](/tags/nodejs)のバージョンがv12またはv14で、Windows, Linux, Mac OS の3つのOSで動作することを確認済みです
- [Node.js](/tags/nodejs) v12以上のバージョンで動作します
  - 古いバージョンを使用している場合はアップデートしてください
- ボットのトークンは `DISCORD_TOKEN` という名前の環境変数に設定してください
  - `DISCORD_TOKEN` にボットのトークンを設定することで `client.login()` にトークンを渡す必要がないため
- ボットに**メッセージの管理**と**ウェブフックの管理**を与えてください
  - **ウェブフックの管理**を与える理由は、共有化されたチャンネル全てに対して、送信者のユーザーネーム、アバター、メッセージを送信するため
  - **メッセージの管理**を与える理由は、共有化されたチャンネルに対してユーザーが全体にメッセージを送信したあとに、送信者のメッセージを消すためです
    - 同じ内容のメッセージが重複してチャンネルに表示されるのを防ぐためにこの権限が必要になります
  - 一つでも権限が足りないと、コマンドを使用できません
- ボットのメッセージは無視されます
- 有効ではないサーバーでは使用できません

## どこまで送信できるのか

メッセージの送信はもちろん、アバター、ユーザーネームも設定され、まるで本人が送信しているかのように見えます（実際はWebhook）

添付ファイルにも対応しており、ファイルのやり取りも可能です（ただし、マルウェアのチェックなどはサポートしていないので注意が必要）

## 使用方法

コマンドの使用方法です。2つのコマンドを使用して、共有チャンネルの追加、削除をします。

- `!addShareChannel <チャンネルのメンション（複数可能）>`
- `!removeShareChannel <チャンネルのメンション（複数可能）>`

なお、これらのコマンドを使用できるのは。**サーバー管理**、**ウェブフックの管理**権限を持っているユーザーのみです。

一般のユーザーが使用できるということはないので、安心してください。

### メッセージを共有するチャンネルを追加する

共有化するチャンネルを設定するコマンドです。

```
!addShareChannel <チャンネルのメンション（複数可能）>
```

### メッセージを共有するチャンネルを削除する

共有化しているチャンネルを削除するコマンドです。

```
!removeShareChannel <チャンネルのメンション（複数可能）>
```

## 機能追加やバグ報告

[リポジトリ](https://github.com/InkoHX/share-chat-webhook-discordjs)がありますので、そちらにプルリクエスト、バグ報告をお願いします。

機能の追加については、issuesで提案していただければ、追加するかもしれません。

皆さんの要望お待ちしてます。
